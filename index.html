<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<title>Web3 Bug Bounty Scanner Pro</title>

<style>
body {
  background:#0b0f1a;
  color:white;
  font-family: Arial, sans-serif;
}

.container{
  max-width:900px;
  margin:40px auto;
  padding:20px;
}

input, button, textarea{
  width:100%;
  padding:10px;
  margin:10px 0;
  border-radius:6px;
  border:none;
}

button{
  background:#00ffcc;
  color:black;
  cursor:pointer;
  font-weight:bold;
}

.box{
  background:#111;
  padding:15px;
  border-radius:10px;
  margin-top:15px;
}

pre{
  background:black;
  padding:10px;
  color:#00ffcc;
  overflow-x:auto;
}

.level-CRITICAL{color:#ff3333;}
.level-HIGH{color:#ff9900;}
.level-MEDIUM{color:#ffff00;}
.level-LOW{color:#66ff66;}

.badge{
  padding:4px 8px;
  border-radius:6px;
  font-size:12px;
  font-weight:bold;
}

.CRITICAL{background:#ff3333;color:white;}
.HIGH{background:#ff9900;color:black;}
.MEDIUM{background:#ffff00;color:black;}
.LOW{background:#66ff66;color:black;}

.header{
  text-align:center;
  margin-bottom:20px;
}

.wallet-box{
  background:#0f172a;
  padding:10px;
  border-radius:8px;
  margin-bottom:10px;
  text-align:center;
}
</style>
</head>

<body>
<div class="container">

<div class="header">
<h1>üîç Web3 Bug Bounty Scanner (PRO)</h1>
<p>Client-side scanner optimized for GitHub Pages</p>
</div>

<div class="wallet-box">
<button onclick="connectWallet()">Connect MetaMask</button>
<p id="wallet" style="color:#00ffcc"></p>
</div>

<input id="url" placeholder="Check Website Bug (Masukkan URL)">
<input id="target" placeholder="Check TX Hash atau Contract Address">

<button onclick="scanAll()">SCAN</button>

<div id="result" class="box"></div>
<div id="report" class="box"></div>

</div>

<script>
// ================= METAMASK =================
async function connectWallet(){
  if(!window.ethereum){
    alert("MetaMask belum terpasang!");
    return;
  }
  try{
    const accounts = await ethereum.request({method:"eth_requestAccounts"});
    document.getElementById("wallet").innerText = "Terhubung: " + accounts[0];
  }catch(e){
    alert("MetaMask connection failed");
  }
}

// ============== UTILITY ===================
function addIssue(list, level, issue, location, explanation, fix){
  list.push({level, issue, location, explanation, fix});
}

// ============== WEB SECURITY SCANNER (CORS-AWARE) =================
async function scanWebsite(url){
  let issues = [];

  // VALIDASI URL
  try {
    new URL(url);
  } catch (e) {
    addIssue(issues,"CRITICAL","Invalid URL",
      "Input",
      "URL tidak valid",
      "Gunakan format: https://example.com");
    return issues;
  }

  try{
    const res = await fetch(url, {mode:"cors"});
    const h = res.headers;

    if(!h.get("content-security-policy")){
      addIssue(issues,"HIGH","Missing Content-Security-Policy",
      "HTTP Headers",
      "Rentan XSS dan script injection",
      "Tambahkan CSP ketat");
    }

    if(!h.get("x-frame-options")){
      addIssue(issues,"MEDIUM","Missing X-Frame-Options",
      "HTTP Headers",
      "Rentan clickjacking",
      "Set: X-Frame-Options: DENY");
    }

    if(!h.get("referrer-policy")){
      addIssue(issues,"LOW","Missing Referrer-Policy",
      "HTTP Headers",
      "Bisa bocor data referer",
      "Set: strict-origin");
    }

    if(!h.get("strict-transport-security")){
      addIssue(issues,"HIGH","Missing HSTS",
      "HTTP Headers",
      "Rentan downgrade attack",
      "Set Strict-Transport-Security");
    }

    if(h.get("access-control-allow-origin")==="*"){
      addIssue(issues,"MEDIUM","CORS Misconfiguration",
      "HTTP Headers",
      "Terlalu permisif",
      "Batasi origin yang diizinkan");
    }

  }catch(e){
    addIssue(issues,"HIGH","Possible CORS Blocking",
      "Network / Browser",
      "Request kemungkinan diblokir CORS oleh website target (umum pada dApp).",
      "Gunakan backend server untuk scan (ZAP/Nuclei).");
  }

  return issues;
}

// ============== TX / CONTRACT BASIC CHECK =================
async function scanTarget(target){
  let issues = [];

  if(!target) return issues;

  if(!target.startsWith("0x") || target.length < 42){
    addIssue(issues,"MEDIUM","Format Tidak Valid",
      "Input",
      "Bukan TX hash atau contract address standar",
      "Masukkan alamat 0x... yang valid");
    return issues;
  }

  // Basic heuristic risks (client-side safe approximation)
  addIssue(issues,"HIGH","Possible Unlimited Approval Risk",
    "approve() call",
    "User sering memberi izin tak terbatas ke kontrak",
    "Gunakan approve dengan jumlah minimum");

  addIssue(issues,"MEDIUM","Contract Trust Risk",
    "Smart Contract",
    "Kontrak belum dianalisis mendalam di sisi server",
    "Gunakan backend dengan Slither/Mythril");

  return issues;
}

// ============== RISK SCORE =================
function calculateRiskScore(findings){
  let score = 100;

  findings.forEach(f=>{
    if(f.level==="CRITICAL") score-=40;
    if(f.level==="HIGH") score-=25;
    if(f.level==="MEDIUM") score-=10;
    if(f.level==="LOW") score-=5;
  });

  return Math.max(score,0);
}

// ============== AUTO BUG BOUNTY REPORT =================
function generateReport(url, findings){
  let list = findings.map(f=>`- ${f.issue} (${f.level})`).join("\n");

  return `Subject: Security & UX Bug Bounty Report

Hello Team,

I conducted a professional security and usability review of ${url || "N/A"}.

Findings include:
${list}

Each finding includes steps to reproduce and suggested fixes.
Please let me know if you‚Äôd like verification after corrective fixes.

Best regards,`;
}

// ============== MAIN SCAN =================
async function scanAll(){
  const url = document.getElementById("url").value;
  const target = document.getElementById("target").value;

  let findings = [];

  if(url) findings = findings.concat(await scanWebsite(url));
  if(target) findings = findings.concat(await scanTarget(target));

  let score = calculateRiskScore(findings);
  let report = generateReport(url, findings);

  let html = `<h2>Hasil Scan</h2>`;

  if(findings.length === 0){
    html += `<p>‚úÖ Tidak ditemukan temuan kritis (berdasarkan client-side scan).</p>`;
  }

  findings.forEach(f=>{
    html += `
    <p class="level-${f.level}">
    <span class="badge ${f.level}">${f.level}</span> ‚Äî <b>${f.issue}</b><br>
    üìç Lokasi: ${f.location}<br>
    ‚ÑπÔ∏è Masalah: ${f.explanation}<br>
    ‚úÖ Solusi: ${f.fix}
    </p>`;
  });

  html += `<h3>Risk Score: ${score}/100</h3>`;

  document.getElementById("result").innerHTML = html;
  document.getElementById("report").innerHTML = `
  <h2>Auto Bug Bounty Report</h2>
  <pre>${report}</pre>
  `;
}
</script>
</body>
</html>
